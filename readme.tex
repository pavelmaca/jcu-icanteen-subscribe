\documentclass[a4]{article}
\usepackage{xltxtra,polyglossia} 
\setdefaultlanguage{czech} 
\usepackage[]{graphicx}
\usepackage{listings}
\usepackage{color}

\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}
 
\lstdefinestyle{mystyle}{
    backgroundcolor=\color{backcolour},   
    commentstyle=\color{codegreen},
    keywordstyle=\color{magenta},
    numberstyle=\tiny\color{codegray},
    stringstyle=\color{codepurple},
    basicstyle=\footnotesize,
    breakatwhitespace=false,         
    breaklines=true,                 
    captionpos=b,                    
    keepspaces=true,                 
    numbers=left,                    
    numbersep=5pt,                  
    showspaces=false,                
    showstringspaces=false,
    showtabs=false,                  
    tabsize=2
}
 
\lstset{style=mystyle}

\title{Odběr jídelníčků z menzy JCU}
\author{Pavel Máca}

\begin{document}
\begin{titlepage}
	\centering
	{\Huge Operační systémy 2\par}
	\vspace{1cm}
	{\Large Zimní semestr 2016/17\par}
	\vspace{1.5cm}
	{\huge\bfseries Odběr jídelníčků z menzy JČU\par}
	\vspace{2cm}
	{\Large Pavel Máca\par}
	\vfill


	{\large \today\par}
\end{titlepage}

\pagebreak

\section{Úvod}
Účelem projektu se vytvořit emailové notifikace na nově vystavený jídelní lístek v menze jihočeské Univerzity.

Uživatel má možnost s přihlásit k odběru, který funguje na principu newsletteru. Na stránkách aplikace pouze vyplní svůj email. Při dalším vystavení jídelníčku ho bude aplikace informovat o vybraných specialitách.

Mnohokrát se stává, že si chce někdo objednat specialitu přes internetové stránky menzi, ale ta je již vyprodaná. Díky včasnému upozornění lze vytvořit objednávku vždy v čas.


\section{Metodika}
Jako programovací jazyk bylo zvoleno PHP. Kód může běžet jak na Windows, tak OS Linux  a dalších, pro které existuje zkompilované PHP a případně nějaký http server.

\section{Popis skriptu}
Běžící aplikace je k dispozici na adrese https://menza-jcu.assassik.cz 
Kontrola jídelníčku probíhá v hodinových intervalech.

Samotná kontrola jídelníčku se spouští na serveru pomocí cronu. Zde se používá přímé provádění php scriptu pomoc příkazu „php“. Script načte aktuálně zveřejněný jídelníček, zpracuje HTML kód ve kterém se nachází data a názvy jídel.

Datum posledního jídla je uloženo do paměti scriptu zvaná „cache“, podle které se rozpoznávají nová jídla při dalším spuštění.

V okamžiku, kdy se uživatel přihlásí je jeho email zapsán do SQLite databáze. Při nalezení nového jídla script automaticky pomocí SMTP protokolu rozesílá jednotlivé upozornění na všechny emaily, která se nacházejí v databázi.

Pokud si uživatel nepřeje dostávat další upozornění, nachází se v emailu odkaz pro odhlášení z odběru.

Jelikož je jídelníček zveřejnován třetí stranou, nelze zajistit správný chod aplikace po delší dobu, pokud třetí strana nějak změní datovou strukturu jídelníčku.

\section{Zdrojový kód}
Zdrojová kód je k dispozici na adrese https://github.com/pavelmaca/jcu-icanteen-subscribe 

Vybraná část kódu:
\lstset{language=PHP} 
\begin{lstlisting}
$str = $td->textContent
switch ($colCount) {
  case 0:
    // fisr col contains date
    if (preg_match('~^([0-9]{1,2}\.){2}[0-9]{4}$~', $str)) {
      $date = DateTime::createFromFormat('j.n.Y H:i:s', $str . ' 00:00:00');
    }
    break;
  case 1:
    // type of meal
    $str = self::fixEncoding($str);
    if (preg_match('~^(Specialita) [0-9]~', $str)) {
      $type = $str;
    } else {
      $skip = true;
    }
    break;
  case 3:
    // name of a meal
    $name = $str;
    break;
  }
  $colCount++;
}
\end{lstlisting}



\section{Závěr}
Aplikace momentálně podporuje pouze upozornění na speciality z jedné stravovny. Do budoucna by se mohla rozšířit o další funkce, jako výběr typů jídel a další provozovny.

\end{document}
